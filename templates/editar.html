{% extends "index.html" %}
{% block title %}Editar Vehículo{% endblock %}
{% block content %}
<div class="container_result">
    <h1 class="title">Detalles del Vehículo</h1>
    
    {% if auto %}
    <form method="POST" action="{{ url_for('editar_mision', id=auto[0]) }}">
        <div class="details-grid">
            <div class="detail-item">
                <label class="label">Nombre</label>
                <input type="text" name="name" value="{{ auto[1] }}" required>
            </div>
            <div class="detail-item">
                <label class="label">Matrícula</label>
                <input type="text" name="matricula" value="{{ auto[2] }}" required>
            </div>
            <div class="detail-item">
                <label class="label">Marca</label>
                <input type="text" name="marca" value="{{ auto[3] }}" required>
            </div>
            <div class="detail-item">
                <label class="label">Modelo</label>
                <input type="text" name="model" value="{{ auto[4] }}" required>
            </div>
            <div class="detail-item">
                <label class="label">Año</label>
                <input type="text" name="year" value="{{ auto[5] }}" required>
            </div>
            <div class="detail-item">
                <label class="label">Motor</label>
                <input type="text" name="motor" value="{{ auto[6] }}" required>
            </div>
        </div>

        <h2 class="subtitle">Historial de Trabajos</h2>
        <table class="work-table">
            <thead>
                <tr>
                    <th>FECHA</th>
                    <th>KILOMETRAJE</th>
                    <th>TRABAJO REALIZADO</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="workTableBody">
                {% if trabajos %}
                    {% for trabajo in trabajos %}
                    <tr>
                        <td><input type="date" name="date[]" value="{{ trabajo[9] }}" required></td>
                        <td><input type="text" name="kl[]" value="{{ trabajo[7] }}" required></td>
                        <td class="work-cell">
                            <textarea name="work[]" class="work-input" required>{{ trabajo[8] }}</textarea>
                        </td>
                        <td>
                            <button type="button" class="btn-eliminar" onclick="eliminarFila(this)">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td><input type="date" name="date[]" value="{{ today }}" required></td>
                        <td><input type="text" name="kl[]" required></td>
                        <td class="work-cell">
                            <textarea name="work[]" class="work-input" required></textarea>
                        </td>
                        <td>
                            <button type="button" class="btn-eliminar" onclick="eliminarFila(this)">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        
        <div class="button-container">
            <button type="button" class="button-action" onclick="agregarFila()">
                <i class="fas fa-plus"></i> Agregar Trabajo
            </button>
            <button type="submit" class="button-action">
                <i class="fas fa-save"></i> Guardar Cambios
            </button>
            <a href="{{ url_for('buscar_auto') }}" class="button-action">
                <i class="fas fa-times"></i> Cancelar
            </a>
        </div>
    </form>
    {% endif %}
</div>

<script>
    function eliminarFila(boton) {
        const tbody = document.getElementById('workTableBody');
        if (tbody.children.length > 1) {
            boton.closest('tr').remove();
        } else {
            alert('Debe mantener al menos un registro de trabajo');
        }
    }
    
    function agregarFila() {
        const tbody = document.getElementById('workTableBody');
        const fechaHoy = new Date().toISOString().split('T')[0];
        const nuevaFila = document.createElement('tr');
        nuevaFila.innerHTML = `
            <td><input type="date" name="date[]" value="${fechaHoy}" required></td>
            <td><input type="text" name="kl[]" required></td>
            <td class="work-cell">
                <textarea name="work[]" class="work-input" required></textarea>
            </td>
            <td>
                <button type="button" class="btn-eliminar" onclick="eliminarFila(this)">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </td>
        `;
        tbody.appendChild(nuevaFila);
    }
</script>
{% endblock %}
